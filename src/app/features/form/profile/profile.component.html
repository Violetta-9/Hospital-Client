<div class="ms-lg-5 ps-lg-5 mt-lg-5 col-lg-12 row" >

  <div class="col-lg-2 me-lg-3">
    <img *ngIf="profileUser.documentAbsolutUrl!=undefined && profileUser.documentAbsolutUrl=='http://127.0.0.1:10000/devstoreaccount1/hospital-documents/' && newPhoto==undefined" src="/assets/user.png">
    <img *ngIf="profileUser.documentAbsolutUrl!=undefined && profileUser.documentAbsolutUrl!='http://127.0.0.1:10000/devstoreaccount1/hospital-documents/' && newPhoto==undefined " [src]="profileUser.documentAbsolutUrl"  alt="">
    <img *ngIf="newPhoto!=undefined" [src]="newPhoto">
  </div>

  <div class="col-lg-10 row">
    <div class="col-lg-4 mt-lg-3 ">
    <div class="h5">{{profileUser.firstName+" "+profileUser.lastName+" "+profileUser.middleName}}</div>
  </div>
    <div *ngIf="userRole!=undefined && userRole=='doctor'" class="col-lg-5 mt-lg-1 ">
      <form  [formGroup]="statusGroup">
      <mat-form-field class="full-width">
        <mat-select placeholder="Status" formControlName="status"  (selectionChange)="onSelect($event)">
          <mat-option *ngFor="let status of statuses" [value]="status.id"   >
            {{status.title}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      </form>
    </div>
    <div class="col-lg-3">
      <button class="col-lg-6" mat-raised-button color="warn" (click)="deletePerson(profileUser)" >Delete</button>
    </div>


<div class="col-lg-12 row">
    <div *ngIf="userRole!=undefined && userRole=='doctor'" class="col-lg-3 row share ">
      <div class="col-lg-2">
        <i class="fa fa-briefcase" aria-hidden="true"></i>
      </div>

      <div class="col-lg-9 row">
        <div class="title">Specialization</div>
        <div>{{profileUser.specializationTitle}}</div>
      </div>
    </div>



    <div *ngIf="userRole!=undefined && userRole!='patient'" class="col-lg-3 row share ">
      <div class="col-lg-2">
        <i class="fa fa-map-marker" aria-hidden="true"></i>
      </div>

      <div class="col-lg-9 row">
        <div class="title">Location</div>
        <div>{{profileUser.officeAddress}}</div>
      </div>
    </div>

    <div *ngIf="userRole!=undefined && userRole=='doctor'" class="col-lg-3 row share ">
      <div class="col-lg-2">
        <i class="fa fa-calendar" aria-hidden="true"></i>
      </div>

      <div class="col-lg-9 row">
        <div class="title">Year start of career</div>
        <div>{{profileUser.careerStartYear | date}}</div>
      </div>
    </div>

  </div>
  </div>

</div>

<mat-expansion-panel class="mt-lg-4" (opened)="panelOpenState = true"
                     (closed)="panelOpenState = false">
  <mat-expansion-panel-header>
    <mat-panel-title class="h6">
      Personal information
    </mat-panel-title>
  </mat-expansion-panel-header>
<app-form-update-personal-info [userProfile]="profileUser" [userRole]="userRole" (newDataForUpdating)="updatePersonalData($event)" ></app-form-update-personal-info>

</mat-expansion-panel>



<mat-expansion-panel *ngIf="userRole!=undefined && userRole!='patient'"  (opened)="panelOpenState = true"
                     (closed)="panelOpenState = false">
  <mat-expansion-panel-header>
    <mat-panel-title class="h6">
    Work information
    </mat-panel-title>
  </mat-expansion-panel-header>

<app-form-update-work-info [userProfile]="profileUser"  [userRole]="userRole" (workDataForUpdating)="updateWorkData($event)" ></app-form-update-work-info>
</mat-expansion-panel>

<mat-expansion-panel *ngIf="userRole!=undefined && userRole=='patient'"  (opened)="panelOpenState = true"
                     (closed)="panelOpenState = false">
  <mat-expansion-panel-header>
    <mat-panel-title class="h6">
      Results
    </mat-panel-title>
  </mat-expansion-panel-header>
  <mat-tree [dataSource]="dataSource" [treeControl]="treeControl">
    <!-- This is the tree node template for leaf nodes -->
    <mat-tree-node *matTreeNodeDef="let node" matTreeNodePadding>
      <!-- use a disabled button to provide padding for tree leaf -->
      <button mat-icon-button disabled></button>
      <span [innerHTML]="node.name" ></span>
    </mat-tree-node>
    <!-- This is the tree node template for expandable nodes -->
    <mat-tree-node *matTreeNodeDef="let node;when: hasChild" matTreeNodePadding>
      <button mat-icon-button matTreeNodeToggle
              [attr.aria-label]="'Toggle ' + node.name">
        <mat-icon class="mat-icon-rtl-mirror">
          {{treeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
        </mat-icon>
      </button>
      <span [innerHTML]="node.name"></span>
    </mat-tree-node>
  </mat-tree>


</mat-expansion-panel>

<mat-expansion-panel *ngIf="userRole!=undefined && userRole=='patient'"  (opened)="panelOpenState = true"
                     (closed)="panelOpenState = false">
  <mat-expansion-panel-header>
    <mat-panel-title class="h6">
      Upcoming Appointments
    </mat-panel-title>
  </mat-expansion-panel-header>
  <div class="d-flex justify-content-center">
  <table mat-table [dataSource]="dataSourceTable"  class="mat-elevation-z8 col-10 ">

    <ng-container matColumnDef="doctor">
      <th mat-header-cell *matHeaderCellDef> Doctor </th>
      <td mat-cell *matCellDef="let element">
        {{element.doctorFullName}}
      </td>
    </ng-container>

    <ng-container matColumnDef="date">
      <th mat-header-cell *matHeaderCellDef> Date </th>
      <td mat-cell *matCellDef="let element"> {{element.dateTime | date:'dd.MM.yyyy HH:mm'}} </td>
    </ng-container>

    <!-- Symbol Column -->
    <ng-container matColumnDef="service">
      <th mat-header-cell *matHeaderCellDef> Service </th>
      <td mat-cell *matCellDef="let element"> {{element.serviceName}} </td>
    </ng-container>


    <ng-container matColumnDef="action">
        <th mat-header-cell *matHeaderCellDef> Action </th>
        <td mat-cell *matCellDef="let element">
          <div class="d-flex flex-column col-5 mt-2">
            <button  [disabled]="element.resultId" mat-raised-button color="primary" (click)="rescheduleAppointment(element)"> Reschedule appointment</button>
            <small  [style.color]="element.isApprove ? 'blue': 'red'"> *The appointment is {{element.isApprove ? 'approved': 'under review'}} </small>
          </div>
        </td>

    </ng-container>

    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
    <tr mat-row *matRowDef="let row; columns: displayedColumns;" ></tr>
  </table>
  </div>

</mat-expansion-panel>
